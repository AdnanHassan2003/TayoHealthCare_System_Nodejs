<% include header.html %>


<script>
    function timeSince(date) {
      date = new Date(date);
      var seconds = Math.floor((new Date() - date) / 1000);

      var interval = seconds / 31536000;

      if (interval > 1) {
        return Math.floor(interval) + " year(s) ago";
      }
      interval = seconds / 2592000;
      if (interval > 1) {
        return Math.floor(interval) + " month(s) ago";
      }
      interval = seconds / 86400;
      if (interval > 1) {
        return Math.floor(interval) + " day(s) ago";
      }
      interval = seconds / 3600;
      if (interval > 1) {
        return Math.floor(interval) + " hour(s) ago";
      }
      interval = seconds / 60;
      if (interval > 1) {
        return Math.floor(interval) + " minute(s) ago";
      }
      return Math.floor(seconds) + " second(s) ago";
    }
  </script>

<!DOCTYPE html>
<html lang="en">
<head > 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    
     <link rel="stylesheet" href="colors.css">

</head>
<body data-bs-spy="scroll" data-bs-target=".navbar" data-bs-offset="70">
  <form style="background-color: #ffffff; padding: 10px; margin-bottom:10px;" class="form-data" role="form"
  method="post" action="/admin">

    <div class="container">
        <div class="row">
          <% if(TotalAdmin.length > 0) {%>
            
            
            <div class="card " style="width: 280px; height: 160px; margin-left: 30px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
                <div class="card-body">   
                    <img class="card-img-top " style="width: 50px; margin-left: 55px;" src="user.png" class="rounded-circle" alt="Card image">
                    <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Admin</strong></h1>
                    <br>
                      <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;"><%= TotalAdmin[0].Total_Admin %></strong>    
                </div>
            </div>
            <%} else {%>
              <div class="card " style="width: 280px; height: 160px; margin-left: 30px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
                <div class="card-body">   
                    <img class="card-img-top " style="width: 50px; margin-left: 55px;" src="user.png" class="rounded-circle" alt="Card image">
                    <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Admin</strong></h1>
                    <br>
                      <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;">0</strong>    
                </div>
            </div>
              <%}%>

            <% if(TotalDoctor.length > 0) {%>
            <div class="card ml-5" style="width: 280px; height: 160px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
                <div class="card-body">
                    <img class="card-img-top" style="width: 50px; margin-left: 22%;" src="doctors1.png" class="rounded-circle" alt="Card image">
                    <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Doctor</strong></h1>
                    <br>
                      <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;"><%= TotalDoctor[0].Total_Doctor %></strong>   
                </div>
            </div>

            <%}else {%>
              <div class="card ml-5" style="width: 280px; height: 160px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
                <div class="card-body">
                    <img class="card-img-top" style="width: 50px; margin-left: 22%;" src="doctors1.png" class="rounded-circle" alt="Card image">
                    <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Doctor</strong></h1>
                    <br>
                      <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;">0</strong>   
                </div>
            </div>
              <%}%>

           <% if(TotalPatient.length >0) {%>
            
            <div class="card ml-5" style="width: 280px; height: 160px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
              <div class="card-body">
                  <img class="card-img-top" style="width: 50px; margin-left: 20%;" src="patient.png" class="rounded-circle" alt="Card image">
                  <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Patient</strong></h1>
                  <br>
                      <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;"><%= TotalPatient[0].Total_Patient %></strong>
              </div>
          </div>
          <%}else {%>
            <div class="card ml-5" style="width: 280px; height: 160px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
              <div class="card-body">
                  <img class="card-img-top" style="width: 50px; margin-left: 20%;" src="patient.png" class="rounded-circle" alt="Card image">
                  <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Patient</strong></h1>
                  <br>
                      <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;">0</strong>
              </div>
          </div>
            <%}%>


          <% if(TotalHospital.length >0) {%>
               <div class="card ml-5" style="width: 280px; height: 160px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
                <div class="card-body">
                    <img class="card-img-top" style="width: 50px; margin-left: 15%;" src="classs.png" class="rounded-circle" alt="Card image">
                    <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Hospital</strong></h1>
                    <br>
                        <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;"><%= TotalHospital[0].Total_Hospital %></strong>
                </div>
            </div>
            <%}else {%>
              <div class="card ml-5" style="width: 280px; height: 160px; box-shadow: 0 0 20px 0px rgba(0,0,0,0.2);">
                <div class="card-body">
                    <img class="card-img-top" style="width: 50px; margin-left: 15%;" src="classs.png" class="rounded-circle" alt="Card image">
                    <h1 class="card-title mt-3" style="font-size: 20px;"><strong>Total Hospital</strong></h1>
                    <br>
                        <strong class="card-text mt-5" style="margin-top: 100px; margin-left: 90px; text-align: left; font-size: 25px;">0</strong>
                </div>
            </div>
              <%}%>
          
        </div>


        <div class="container" style="margin-top: 70px;">
          <div class="row">
            <div class="card col-md-5" style="margin-left: 70px;">
              <div class="card-header" style="font-size: 20px;">
                Appointments by Status
              </div>
              <div class="card-body">
                <canvas id="barChart" style="width:100%;max-width:600px"></canvas>
              </div>
            </div>

            <div class="card col-md-5" style="margin-left: 70px;">
              <div class="card-header" style="font-size: 20px;">
                Doctors by Speciality
              </div>
              <div class="card-body">
                <canvas id="pieChart" style="width:100%;max-width:600px"></canvas>
              </div>
            </div>
            
          </div>
        </div>

        <div class="container" style="margin-top: 30px;">
          <div class="row">
            <div class="card col-md-5" style="margin-left: 70px;">
              <div class="card-header" style="font-size: 20px;">
                Monthly Appointments
              </div>
              <div class="card-body">
                <canvas id="lineChart" style="width:100%;max-width:600px"></canvas>
              </div>
            </div>

            <div class="card col-md-5" style="margin-left: 70px;">
              <div class="card-header" style="font-size: 20px;">
                Monthly Revenue
              </div>
              <div class="card-body">
                <canvas id="revenueChart" style="width:100%;max-width:600px"></canvas>
              </div>
            </div>
            
          </div>
        </div>
    </div>

    </form>

<script src="./js/bootstrap.bundle.main.js"></script>
<script src="./js/jqeury-3.5.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.main.js"></script>
<script src="./js/jqeury.dataTables.main.js"></script>
<script src="./js/dataTables.bootstrap5.main.js"></script>
<script src="./js/script.js"></script>
    
</body>
</html>





<script>

// Helper function to get status name
function getStatusName(status) {
  const statusMap = {
    0: 'Pending',
    1: 'Confirmed', 
    2: 'Completed',
    3: 'Cancelled',
    4: 'Re-appointment'
  };
  return statusMap[status] || 'Unknown';
}

// Helper function to get month name
function getMonthName(month) {
  const months = [
    'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
  ];
  return months[month - 1] || 'Unknown';
}

// Bar Chart - Appointments by Status
var appointmentStatusData = JSON.parse('<%- JSON.stringify(appointmentStatus || []) %>');
var statusLabels = appointmentStatusData.length > 0 ? appointmentStatusData.map(item => getStatusName(item._id)) : ['No Data'];
var statusCounts = appointmentStatusData.length > 0 ? appointmentStatusData.map(item => item.count) : [0];
var barColors = [
  "#b91d47",
  "#00aba9", 
  "#2b5797",
  "#e8c3b9",
  "#1e7145"
];

new Chart("barChart", {
  type: "bar",
  data: {
    labels: statusLabels,
    datasets: [{
      backgroundColor: barColors,
      data: statusCounts,
      label: 'Appointments'
    }]
  },
  options: {
    legend: {display: false},
    title: {
      display: true,
      text: "Appointments by Status"
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          stepSize: 1
        }
      }
    }
  }
});

// Pie Chart - Doctors by Speciality
var doctorSpecialityData = JSON.parse('<%- JSON.stringify(doctorSpeciality || []) %>');
var specialityLabels = doctorSpecialityData.length > 0 ? doctorSpecialityData.map(item => item._id || 'Unknown') : ['No Data'];
var specialityCounts = doctorSpecialityData.length > 0 ? doctorSpecialityData.map(item => item.count) : [0];
var pieColors = [
  "#FF6384",
  "#36A2EB",
  "#FFCE56", 
  "#4BC0C0",
  "#9966FF",
  "#FF9F40"
];

new Chart("pieChart", {
  type: "pie",
  data: {
    labels: specialityLabels,
    datasets: [{
      backgroundColor: pieColors,
      data: specialityCounts
    }]
  },
  options: {
    title: {
      display: true,
      text: "Doctors by Speciality"
    },
    plugins: {
      legend: {
        position: 'bottom'
      }
    }
  }
});

// Line Chart - Monthly Appointments
var monthlyAppointmentsData = JSON.parse('<%- JSON.stringify(monthlyAppointments || []) %>');
var monthLabels = monthlyAppointmentsData.length > 0 ? monthlyAppointmentsData.map(item => 
  getMonthName(item._id.month) + ' ' + item._id.year
) : ['No Data'];
var appointmentCounts = monthlyAppointmentsData.length > 0 ? monthlyAppointmentsData.map(item => item.count) : [0];

new Chart("lineChart", {
  type: "line",
  data: {
    labels: monthLabels,
    datasets: [{
      label: 'Appointments',
      data: appointmentCounts,
      borderColor: "#36A2EB",
      backgroundColor: "rgba(54, 162, 235, 0.1)",
      tension: 0.1,
      fill: true
    }]
  },
  options: {
    title: {
      display: true,
      text: "Monthly Appointments Trend"
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          stepSize: 1
        }
      }
    }
  }
});

// Revenue Chart - Monthly Payments
var monthlyPaymentsData = JSON.parse('<%- JSON.stringify(monthlyPayments || []) %>');
var revenueMonthLabels = monthlyPaymentsData.length > 0 ? monthlyPaymentsData.map(item => 
  getMonthName(item._id.month) + ' ' + item._id.year
) : ['No Data'];
var revenueAmounts = monthlyPaymentsData.length > 0 ? monthlyPaymentsData.map(item => item.total || 0) : [0];

new Chart("revenueChart", {
  type: "bar",
  data: {
    labels: revenueMonthLabels,
    datasets: [{
      label: 'Revenue',
      data: revenueAmounts,
      backgroundColor: "#4BC0C0",
      borderColor: "#4BC0C0",
      borderWidth: 1
    }]
  },
  options: {
    title: {
      display: true,
      text: "Monthly Revenue"
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          callback: function(value) {
            return '$' + value.toLocaleString();
          }
        }
      }
    }
  }
});

$(document).ready(function () {
  $(".data-table").each(function (_, table) {
    $(table).DataTable();
  });
});

</script>


